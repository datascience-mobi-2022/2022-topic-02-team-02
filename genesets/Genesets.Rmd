---
title: "Gene sets"
author: "Maja Glotz"
date: "5/16/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(msigdbr)
library(biomaRt)
library(vissE)
library(GeneOverlap)
?newGlibrary(dplyr)
library(ggplot2)
```

```{r}
#load data
genesets = readRDS("../data/hallmarks_genesets.rds")
```


```{r}
#JACCARD INDEX
# extract all 46 genesets
all.genesets = as.list(genesets[[1]])
# create gene overlap matrix for all gene sets on itself
go.matrix = newGOM(all.genesets, all.genesets)
#create matrix only for jaccard index
jaccard.matrix = getMatrix(go.matrix, "Jaccard")
#order rows and columns alphabetically, so order is the same
jaccard.matrix = data.matrix(real[order(row.names(real)), ])
jaccard.matrix = data.matrix(real[, order(colnames(real))])

#create dataframe from jaccard matrix
jaccard.df = as.data.frame(jaccard.matrix)
#melt for ggplot
melted = melt(jaccard.df)
#create vector with 46 gene set names
r = rownames(jaccard.matrix)
#46 times, for melted df --> get two columns with all gene set combinations
variable2 = rep(r, 46)
#new column
melted = cbind(melted, variable2)
#rename value into Jaccard index
names(melted)[names(melted) == "value"] <- "Jaccard"

#ggplot Jaccard index as heatmap
ggplot(melted, aes(variable, variable2, fill = Jaccard)) + 
  geom_tile(colour = "white") +
  scale_fill_gradient(low = "white", high = "steelblue") +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1)) +
  xlab(" ") +
  ylab(" ") +
  ggtitle("Jaccard index for hallmark gene sets") +
  theme(plot.title = element_text(hjust = 0.5))
```

