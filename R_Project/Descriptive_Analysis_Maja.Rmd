---
title: "Descriptive_Analysis_Maja"
author: "Maja Glotz"
date: "5/10/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
#loag vioplot package
library(vioplot)
library(ggplot2)
library(dplyr)
library(ggrepel)
```


```{r}
#density plot for tcga_exp_var -> variance across all genes
plot(density(tcga_exp_var), main = "Density distribution of variance for all genes", xlab = "variance", ylab = "density"); abline(v= quantile(tcga_exp_var,0.5), col = "blue"); text(13, 0.2, "p50-quantile", col = "blue")

```


```{r}
#violin plot for tcga_exp_var
vioplot(tcga_exp_var, main = "Variance distribution", ylab = "variance"); abline(h = quantile(tcga_exp_var,0.5), col = "blue", lty = "dashed" ); text(1.42,17, "p50-quantile", col = "blue")
```

```{r}
#variance density plot for cleaned tcga_exp_clean
plot(density(tcga_exp_clean_var)); abline(v = 2.29988)
plot(density(tcga_exp_clean_var), main = "Variance distribution after high variance filtering", xlab = "variance", ylab = "density")
```

```{r}
#variance violin plot for cleaned data
vioplot(tcga_exp_clean_var, main = "Variance distribution", ylab = "variance"); abline(h = quantile(tcga_exp_var,0.5), col = "blue", lty = "dashed" ); text(1.42,17, "threshold", col = "blue")
```


```{r}
#try to combine violin plots
vioplot(tcga_exp_var, tcga_exp_clean_var, main = "Variance distribution", names = c("tcga_exp","tcga_exp_clean"), ylab = "variance"); abline(h = quantile(tcga_exp_var,0.5), col = "blue", lty = "dashed" ); text(1.5,68, "p50-quantile = threshold", col = "blue")
```

```{r}
# compute mean expression fpr all genes
tcga_exp_mean = apply(tcga_exp, 1, mean)
# create data frame out of mean and variance vector since ggplot only takes this as input
tcga_exp_meanvar = data.frame(tcga_exp_mean, tcga_exp_var)
# mean/variance plot across all genes
ggplot(tcga_exp_meanvar, aes(tcga_exp_mean, tcga_exp_var)) + geom_point(shape = ".",alpha=0.35)
```

```{r}
#try mean/variance plot with 3 layers of data: 
# 1) the removed low variance genes in grey
tcga_exp_low_mean = tcga_exp_mean[tcga_exp_var_50]
tcga_exp_low_var = tcga_exp_var[tcga_exp_var_50]
tcga_exp_low_meanvar = data.frame(tcga_exp_low_mean, tcga_exp_low_var)
# 2) "normal" mean/variance in black
# 3) special outliers in orange
tcga_exp_high_var = tcga_exp_var[tcga_exp_var > quantile(tcga_exp_var, 0.99)]
mean_for_high_var = tcga_exp_mean[names(tcga_exp_high_var)]
tcga_exp_high_meanvar = data.frame(mean_for_high_var, tcga_exp_high_var)
#plot
ggplot(tcga_exp_meanvar, aes(tcga_exp_mean, tcga_exp_var, color = 'Average-high variance genes')) + geom_point(shape = ".",alpha=0.35) + geom_point(data = tcga_exp_low_meanvar, aes(tcga_exp_low_mean, tcga_exp_low_var), color = "blue", shape = ".", alpha=0.4, color = 'Low variance genes')  + geom_point(data = tcga_exp_high_meanvar, aes(mean_for_high_var, tcga_exp_high_var), color = "orange", color = 'Very high variance genes', shape = ".") + geom_text_repel(data = tcga_exp_high_meanvar, aes(mean_for_high_var, tcga_exp_high_var), label = row.names(tcga_exp_high_meanvar), size = 2, show.legend = FALSE) + ggtitle("mean/variance plot before data cleaning") + theme(plot.title = element_text(hjust = 0.5)) + xlab("average gene expression") + ylab("variance") + scale_color_manual(name='Regression Model',
                     breaks=c('Low variance genes', 'Average-high variance genes', 'Very high variance genes'),
                     values=c('Low variance genes'='blue', 'Average-high variance genes'='black', 'Very high variance genes'='orange')) + guides(color = guide_legend(override.aes = list(size = 5)))
#Legenden punkte werden nicht größer???
```

```{r}
#new plot with lower high variance threshold?

```

